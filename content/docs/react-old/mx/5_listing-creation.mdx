---
title: "Implementing Listing Creation"
description:
   "Allow users to publish project listings with multi-step workflows and draft
   persistence."
module: "MX"
lesson: "5"
difficulty: "advanced"
duration: "35"
project_phase: "Advanced polish"
prerequisites: ["/docs/react/mx/4_users-profiles"]
learning_objectives:
   - "Design listing schema with versioning support"
   - "Build a multi-step wizard with autosave"
   - "Integrate React Query mutations with optimistic drafts"
   - "Expose public listing pages"
tags: ["listings", "workflow", "drafts"]
---

# Implementing Listing Creation

## Data Model

```prisma filename="prisma/schema.prisma"
model Listing {
   id          String   @id @default(cuid())
   ownerId     String
   title       String
   description String
   status      ListingStatus @default(DRAFT)
   version     Int      @default(1)
   publishedAt DateTime?
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
}

enum ListingStatus {
   DRAFT
   REVIEW
   PUBLISHED
}
```

---

## Wizard

```tsx filename="src/features/listings/ListingWizard.tsx"
import { useForm, FormProvider } from "react-hook-form";
import { useAutosave } from "@/hooks/useAutosave";
import { useCreateListing, useUpdateListing } from "@/features/listings/api";

export const ListingWizard = ({ listing }: { listing?: Listing }) => {
   const methods = useForm<ListingInput>({
      defaultValues: listing ?? {
         title: "",
         description: "",
         status: "DRAFT",
      },
   });

   const { mutateAsync: saveDraft } = useUpdateListing();
   useAutosave(methods.watch(), (values) =>
      saveDraft({ id: listing?.id, ...values })
   );

   return (
      <FormProvider {...methods}>
         <WizardLayout steps={["Basics", "Details", "Review"]}>
            <WizardStep name='Basics'>
               <TextField label='Title' {...methods.register("title")} />
            </WizardStep>
            <WizardStep name='Details'>
               <MarkdownEditor name='description' control={methods.control} />
            </WizardStep>
            <WizardStep name='Review'>
               <ListingPreview values={methods.getValues()} />
            </WizardStep>
         </WizardLayout>
      </FormProvider>
   );
};
```

---

## Mutations

```ts filename="src/features/listings/api.ts"
export const useCreateListing = () =>
   useMutation({
      mutationFn: (payload: ListingInput) => http.post("/listings", payload),
      onSuccess: (_, __, context) => invalidateListings(),
   });

export const useUpdateListing = () =>
   useMutation({
      mutationFn: (payload: ListingInput & { id?: string }) =>
         http.patch(`/listings/${payload.id}`, payload),
      onMutate: async (payload) => {
         // Optimistic draft update
      },
   });
```

-  Promote draft to `REVIEW` once all steps validated.
-  Require admin approval before marking `PUBLISHED`.

---

## Public Pages

```tsx filename="src/app/listings/[id]/page.tsx"
import { getListing } from "@/features/listings/api";

export default async function ListingPage({
   params,
}: {
   params: { id: string };
}) {
   const listing = await getListing(params.id);
   if (listing.status !== "PUBLISHED") notFound();
   return <ListingDetails listing={listing} />;
}
```

---

## âœ… Validation Checklist

-  [ ] Listing schema deployed with status lifecycle.
-  [ ] Wizard autosaves drafts and preserves steps.
-  [ ] Admin approval flow defined for publishing.
-  [ ] Public listing page respects status gating.

---

