---
title: "Zustand Async Flows"
description:
   "Coordinate asynchronous updates, optimistic UI, and external services with
   Zustand."
module: "M6"
lesson: "7"
difficulty: "advanced"
duration: "35"
project_phase: "Global state"
prerequisites: ["/docs/react/m6/6_zustand-selectors"]
learning_objectives:
   - "Integrate async actions with Zustand using separate services"
   - "Implement optimistic updates with rollback"
   - "Persist remote results and handle errors"
   - "Track analytics around async state changes"
tags: ["zustand", "async", "state-management"]
---

import { Accordions, Accordion } from "@/components/accordion";

# Zustand Async Flows

## Learning Objectives

By the end of this lesson, you will:

-  [ ] Coordinate API calls through services that interact with Zustand.
-  [ ] Perform optimistic updates and rollback cleanly.
-  [ ] Store loading and error state alongside data.
-  [ ] Emit analytics during async operations.

## Async Actions Pattern

```tsx
type TasksState = {
   tasks: Task[];
   isLoading: boolean;
   error: string | null;
   fetchTasks: (projectId: string) => Promise<void>;
};

export const useTasksStore = create<TasksState>((set, get) => ({
   tasks: [],
   isLoading: false,
   error: null,
   async fetchTasks(projectId) {
      set({ isLoading: true, error: null });
      try {
         const response = await api.getTasks(projectId);
         set({ tasks: response.tasks, isLoading: false });
      } catch (error) {
         set({ error: (error as Error).message, isLoading: false });
      }
   },
}));
```

-  Actions are async functions defined inside the store, accessing current state
   via `get`.

---

## Optimistic Updates

```tsx
const optimisticCreateTask = async (input: CreateTaskInput) => {
   const optimisticTask = {
      ...input,
      id: crypto.randomUUID(),
      optimistic: true,
   };
   set((state) => ({ tasks: [optimisticTask, ...state.tasks] }));

   try {
      const saved = await api.createTask(input);
      set((state) => ({
         tasks: state.tasks.map((task) =>
            task.id === optimisticTask.id ? saved : task
         ),
      }));
   } catch (error) {
      set((state) => ({
         tasks: state.tasks.filter((task) => task.id !== optimisticTask.id),
         error: "Failed to create task",
      }));
      analytics.track("task_create_failed", { error });
   }
};
```

-  Ensure rollback removes optimistic entries on failure.
-  Emit analytics to monitor success rates.

---

## Persisting Async Results

-  Combine with `persist` middleware to cache tasks offline.
-  Use `subscribeWithSelector` to trigger effects when certain state changes.

```tsx
import { subscribeWithSelector } from "zustand/middleware";

export const useTasksStore = create<TasksState>()(
   subscribeWithSelector((set, get) => ({
      // ...state
   }))
);

useTasksStore.subscribe(
   (state) => state.error,
   (error) => {
      if (error) toast.error(error);
   }
);
```

<Accordions type='single' className='mt-4'>
   <Accordion title='TaskFlow Pro Async Strategy'>
      <p>Connect Zustand stores with existing async services.</p>

      ```tsx filename="src/state/tasksStore.ts"
      export const useTasksStore = create<TasksState>((set, get) => ({
         // ...state
         async syncProject(projectId) {
            await get().fetchTasks(projectId);
            analytics.track("project_tasks_synced", { projectId });
         },
      }));
      ```

   </Accordion>
</Accordions>

---

## ✅ Validation Checklist

-  [ ] Async actions toggle loading/error flags correctly.
-  [ ] Optimistic updates roll back when API calls fail.
-  [ ] Analytics or logging capture async lifecycle events.

---

<div className='mt-8 flex justify-between'>
   <a
      href='/docs/react/m6/6_zustand-selectors'
      className='text-sm font-medium text-muted-foreground hover:text-foreground'
   >
      ← Zustand Selectors
   </a>
   <a
      href='/docs/react/m6/8_zustand-integration'
      className='text-sm font-medium text-primary hover:text-primary/80'
   >
      Next · Zustand Integration
   </a>
</div>
