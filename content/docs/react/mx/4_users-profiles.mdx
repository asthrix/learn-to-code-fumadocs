---
title: "Implementing Users & Profiles"
description:
   "Add multi-user awareness with profile pages, roles, and avatar uploads."
module: "MX"
lesson: "4"
difficulty: "advanced"
duration: "35"
project_phase: "Advanced polish"
prerequisites: ["/docs/react/mx/3_react-query"]
learning_objectives:
   - "Design profile data model and API contracts"
   - "Build profile pages with editable sections"
   - "Handle avatar uploads with optimistic UI"
   - "Gate features with role-based access control"
tags: ["profiles", "rbac", "uploads"]
---

# Implementing Users & Profiles

## Data Model

```prisma filename="prisma/schema.prisma"
model Profile {
   id          String   @id @default(cuid())
   userId      String   @unique
   displayName String
   bio         String?
   avatarUrl   String?
   role        Role     @default(USER)
   User        User     @relation(fields: [userId], references: [id])
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
}

enum Role {
   USER
   MANAGER
   ADMIN
}
```

---

## Profile Page

```tsx filename="src/app/profile/[id]/page.tsx"
import { getProfile } from "@/features/profiles/api";
import { ProfileEditor } from "@/features/profiles/ProfileEditor";

export default async function ProfilePage({
   params,
}: {
   params: { id: string };
}) {
   const profile = await getProfile(params.id);
   return <ProfileEditor profile={profile} />;
}
```

```tsx filename="src/features/profiles/ProfileEditor.tsx"
export const ProfileEditor = ({ profile }: { profile: Profile }) => {
   const updateProfile = useUpdateProfile();

   return (
      <form className='space-y-6' onSubmit={updateProfile.handleSubmit}>
         <AvatarUpload
            initialUrl={profile.avatarUrl}
            onChange={updateProfile.setAvatar}
         />
         <TextField
            label='Display name'
            defaultValue={profile.displayName}
            onBlur={updateProfile.setName}
         />
         <Textarea
            label='Bio'
            defaultValue={profile.bio ?? ""}
            onBlur={updateProfile.setBio}
         />
         <RoleBadge role={profile.role} />
         <button type='submit' className='btn btn-primary'>
            Save changes
         </button>
      </form>
   );
};
```

---

## Avatar Uploads

```tsx filename="src/features/profiles/AvatarUpload.tsx"
export const AvatarUpload = ({ initialUrl, onChange }: Props) => {
   const [preview, setPreview] = useState(initialUrl);
   const mutation = useUploadAvatar();

   const handleFile = async (file: File) => {
      const url = URL.createObjectURL(file);
      setPreview(url);
      const result = await mutation.mutateAsync(file);
      onChange(result.avatarUrl);
   };

   return (
      <label className='flex items-center gap-3'>
         <img
            src={preview ?? "/avatars/default.png"}
            alt='Avatar preview'
            className='h-12 w-12 rounded-full object-cover'
         />
         <input
            type='file'
            accept='image/*'
            onChange={(event) => {
               const file = event.target.files?.[0];
               if (file) handleFile(file);
            }}
         />
      </label>
   );
};
```

-  Revoke object URLs on unmount to prevent leaks.
-  Validate file type/size before upload.

---

## Role-Based Access Control

```ts filename="src/lib/permissions.ts"
const roleHierarchy = {
   USER: 1,
   MANAGER: 2,
   ADMIN: 3,
} as const;

export const hasPermission = (role: Role, required: Role) => {
   return roleHierarchy[role] >= roleHierarchy[required];
};
```

```tsx filename="src/components/access/RequireRole.tsx"
export const RequireRole = ({
   role,
   children,
}: {
   role: Role;
   children: React.ReactNode;
}) => {
   const { profile } = useCurrentUser();
   if (!profile || !hasPermission(profile.role, role)) return null;
   return <>{children}</>;
};
```

---

## ✅ Validation Checklist

-  [ ] Profile schema deployed with role enumeration.
-  [ ] Profile editor supports avatar uploads with optimistic preview.
-  [ ] Role-based guard usable across routes and components.
-  [ ] Runbook documents how to elevate roles safely.

---

<div className='mt-8 flex justify-between'>
   <a
      href='/docs/react/mx/3_react-query'
      className='text-sm font-medium text-muted-foreground hover:text-foreground'
   >
      ← Implementing React Query
   </a>
   <a
      href='/docs/react/mx/5_listing-creation'
      className='text-sm font-medium text-primary hover:text-primary/80'
   >
      Next · Implementing Listing Creation
   </a>
</div>
