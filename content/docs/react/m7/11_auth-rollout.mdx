---
title: "Auth Rollout & Validation"
description:
   "Ship the invite acceptance flow and validate authentication end-to-end."
module: "M7"
lesson: "11"
difficulty: "advanced"
duration: "45"
project_phase: "Authentication"
prerequisites: ["/docs/react/m7/10_password-reset-flow"]
learning_objectives:
   - "Build the invite acceptance experience"
   - "Instrument onboarding analytics"
   - "Automate auth verification with tests"
   - "Run manual QA and go/no-go checklist"
tags: ["authentication", "testing", "onboarding"]
---

# Auth Rollout & Validation

## Invite Contract

```json filename="invite-response.json"
{
   "email": "sam@taskflow.pro",
   "workspaceName": "Growth Team",
   "role": "manager"
}
```

---

## Invite Acceptance Implementation

```tsx filename="src/app/invite/[token]/page.tsx"
import { fetchInvite } from "@/lib/auth-service";
import { InviteAcceptForm } from "@/components/auth/InviteAcceptForm";

export default async function InvitePage({
   params,
}: {
   params: { token: string };
}) {
   const invite = await fetchInvite(params.token);
   return <InviteAcceptForm invite={invite} token={params.token} />;
}
```

```tsx filename="src/components/auth/InviteAcceptForm.tsx"
export const InviteAcceptForm = ({ invite, token }: Props) => {
   const form = useForm({
      resolver: zodResolver(schema),
      defaultValues: {
         email: invite.email,
         password: "",
         fullName: "",
      },
   });

   const mutation = useMutation({
      mutationFn: (values: FormValues) =>
         AuthService.acceptInvite(token, values),
      onSuccess: () => router.push("/onboarding/welcome"),
   });

   return (
      <form onSubmit={form.handleSubmit((values) => mutation.mutate(values))}>
         <input type='email' {...form.register("email")} readOnly />
         <input
            type='text'
            {...form.register("fullName")}
            placeholder='Full name'
         />
         <input
            type='password'
            {...form.register("password")}
            placeholder='Create password'
         />
         <button type='submit'>Join workspace</button>
      </form>
   );
};
```

```ts filename="src/hooks/useOnboardingTracker.ts"
import { useEffect } from "react";
import { trackAuthEvent } from "@/lib/analytics";

export const useOnboardingTracker = (
   event: "invite_start" | "invite_complete"
) => {
   useEffect(() => {
      trackAuthEvent(event);
   }, [event]);
};
```

---

## Automated Tests

```ts filename="src/__tests__/auth.integration.test.ts"
import { http } from "@/lib/http";

jest.mock("@/lib/http");

describe("AuthService", () => {
   it("stores token on login", async () => {
      (http.post as jest.Mock).mockResolvedValue({
         data: { accessToken: "token" },
      });
      await AuthService.login({
         email: "sam@taskflow.pro",
         password: "password123",
      });
      expect(sessionStorage.getItem("taskflow-access-token")).toBe("token");
   });
});
```

```ts filename="cypress/e2e/auth.cy.ts"
describe("Authentication", () => {
   it("logs in successfully", () => {
      cy.visit("/login");
      cy.findByLabelText(/email/i).type("sam@taskflow.pro");
      cy.findByLabelText(/password/i).type("password123");
      cy.findByRole("button", { name: /sign in/i }).click();
      cy.contains(/dashboard/i).should("exist");
   });

   it("handles reset flow", () => {
      cy.visit("/reset");
      cy.findByLabelText(/email/i).type("sam@taskflow.pro");
      cy.contains(/check your inbox/i).should("exist");
   });
});
```

---

## Manual QA Matrix

| Scenario                        | Expected                                   |
| ------------------------------- | ------------------------------------------ |
| Invalid credentials             | Error message + retry guidance             |
| Refresh token expired           | Redirect to login + "session expired" copy |
| Invite already used             | Redirect to login with explanatory toast   |
| Forgot password email not found | Success message without revealing presence |

---

## Go/No-Go Checklist

-  [ ] Automated tests pass in CI.
-  [ ] Manual QA scenarios completed.
-  [ ] Analytics dashboards show auth events.

---

