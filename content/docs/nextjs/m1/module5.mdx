---
title: Module 5 - Advanced React Concepts
description:
   Master React Context, custom hooks, performance optimization, and advanced
   patterns
---

# Module 5: Advanced React Concepts

In this final module, we'll explore advanced React concepts including Context
API, custom hooks, performance optimization techniques, and architectural
patterns that will help you build scalable React applications.

## React Context API

Context provides a way to share values between components without having to
explicitly pass props through every level of the component tree.

### Basic Context Setup

```jsx
import React, { createContext, useContext, useState } from "react";

// 1. Create Context
const ThemeContext = createContext();

// 2. Create Provider Component
function ThemeProvider({ children }) {
   const [theme, setTheme] = useState("light");

   const toggleTheme = () => {
      setTheme((prevTheme) => (prevTheme === "light" ? "dark" : "light"));
   };

   const value = {
      theme,
      toggleTheme,
   };

   return (
      <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
   );
}

// 3. Custom Hook to Use Context
function useTheme() {
   const context = useContext(ThemeContext);

   if (!context) {
      throw new Error("useTheme must be used within a ThemeProvider");
   }

   return context;
}

// 4. Components Using Context
function Header() {
   const { theme, toggleTheme } = useTheme();

   return (
      <header
         style={{
            backgroundColor: theme === "light" ? "#fff" : "#333",
            color: theme === "light" ? "#333" : "#fff",
            padding: "20px",
            textAlign: "center",
            borderBottom: `2px solid ${theme === "light" ? "#ddd" : "#555"}`,
         }}
      >
         <h1>My App ({theme} mode)</h1>
         <button
            onClick={toggleTheme}
            style={{
               backgroundColor: theme === "light" ? "#007bff" : "#ffc107",
               color: theme === "light" ? "white" : "black",
               border: "none",
               padding: "10px 20px",
               borderRadius: "4px",
               cursor: "pointer",
               marginTop: "10px",
            }}
         >
            Switch to {theme === "light" ? "Dark" : "Light"} Mode
         </button>
      </header>
   );
}

function Content() {
   const { theme } = useTheme();

   return (
      <main
         style={{
            backgroundColor: theme === "light" ? "#f8f9fa" : "#222",
            color: theme === "light" ? "#333" : "#fff",
            padding: "40px",
            minHeight: "400px",
         }}
      >
         <h2>Welcome to the App</h2>
         <p>This content changes with the theme!</p>
      </main>
   );
}

// 5. App Component
function App() {
   return (
      <ThemeProvider>
         <div>
            <Header />
            <Content />
         </div>
      </ThemeProvider>
   );
}
```

### Advanced Context: User Authentication

```jsx
import React, { createContext, useContext, useState, useEffect } from "react";

const AuthContext = createContext();

export function AuthProvider({ children }) {
   const [user, setUser] = useState(null);
   const [loading, setLoading] = useState(true);
   const [error, setError] = useState(null);

   // Check for existing session on mount
   useEffect(() => {
      const checkAuth = async () => {
         try {
            const token = localStorage.getItem("authToken");
            if (token) {
               // Simulate API call to validate token
               const userData = await validateToken(token);
               setUser(userData);
            }
         } catch (err) {
            setError("Failed to authenticate");
            localStorage.removeItem("authToken");
         } finally {
            setLoading(false);
         }
      };

      checkAuth();
   }, []);

   const login = async (email, password) => {
      try {
         setLoading(true);
         setError(null);

         // Simulate login API call
         const response = await simulateLogin(email, password);

         if (response.success) {
            setUser(response.user);
            localStorage.setItem("authToken", response.token);
            return { success: true };
         } else {
            throw new Error(response.message);
         }
      } catch (err) {
         setError(err.message);
         return { success: false, error: err.message };
      } finally {
         setLoading(false);
      }
   };

   const logout = () => {
      setUser(null);
      localStorage.removeItem("authToken");
   };

   const register = async (userData) => {
      try {
         setLoading(true);
         setError(null);

         // Simulate registration API call
         const response = await simulateRegistration(userData);

         if (response.success) {
            setUser(response.user);
            localStorage.setItem("authToken", response.token);
            return { success: true };
         } else {
            throw new Error(response.message);
         }
      } catch (err) {
         setError(err.message);
         return { success: false, error: err.message };
      } finally {
         setLoading(false);
      }
   };

   const value = {
      user,
      loading,
      error,
      login,
      logout,
      register,
      isAuthenticated: !!user,
   };

   return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

export function useAuth() {
   const context = useContext(AuthContext);
   if (!context) {
      throw new Error("useAuth must be used within an AuthProvider");
   }
   return context;
}

// Simulate API functions
async function simulateLogin(email, password) {
   await new Promise((resolve) => setTimeout(resolve, 1000));

   if (email === "user@example.com" && password === "password") {
      return {
         success: true,
         user: { id: 1, name: "John Doe", email },
         token: "fake-jwt-token",
      };
   }

   return {
      success: false,
      message: "Invalid credentials",
   };
}

async function simulateRegistration(userData) {
   await new Promise((resolve) => setTimeout(resolve, 1000));

   return {
      success: true,
      user: { id: 2, ...userData },
      token: "fake-jwt-token",
   };
}

async function validateToken(token) {
   await new Promise((resolve) => setTimeout(resolve, 500));

   if (token === "fake-jwt-token") {
      return { id: 1, name: "John Doe", email: "user@example.com" };
   }

   throw new Error("Invalid token");
}

// Protected Route Component
function ProtectedRoute({ children }) {
   const { isAuthenticated, loading } = useAuth();

   if (loading) {
      return <div>Loading...</div>;
   }

   if (!isAuthenticated) {
      return <LoginForm />;
   }

   return children;
}

// Login Form Component
function LoginForm() {
   const [formData, setFormData] = useState({ email: "", password: "" });
   const { login, loading, error } = useAuth();

   const handleSubmit = async (e) => {
      e.preventDefault();
      await login(formData.email, formData.password);
   };

   const handleChange = (e) => {
      setFormData((prev) => ({
         ...prev,
         [e.target.name]: e.target.value,
      }));
   };

   return (
      <div
         style={{
            maxWidth: "400px",
            margin: "50px auto",
            padding: "20px",
            border: "1px solid #ddd",
            borderRadius: "8px",
         }}
      >
         <h2>Login</h2>

         {error && (
            <div
               style={{
                  color: "#dc3545",
                  backgroundColor: "#f8d7da",
                  padding: "10px",
                  borderRadius: "4px",
                  marginBottom: "15px",
               }}
            >
               {error}
            </div>
         )}

         <form onSubmit={handleSubmit}>
            <div style={{ marginBottom: "15px" }}>
               <label>Email:</label>
               <input
                  type='email'
                  name='email'
                  value={formData.email}
                  onChange={handleChange}
                  placeholder='user@example.com'
                  required
                  style={{
                     width: "100%",
                     padding: "8px",
                     marginTop: "5px",
                     border: "1px solid #ddd",
                     borderRadius: "4px",
                  }}
               />
            </div>

            <div style={{ marginBottom: "15px" }}>
               <label>Password:</label>
               <input
                  type='password'
                  name='password'
                  value={formData.password}
                  onChange={handleChange}
                  placeholder='password'
                  required
                  style={{
                     width: "100%",
                     padding: "8px",
                     marginTop: "5px",
                     border: "1px solid #ddd",
                     borderRadius: "4px",
                  }}
               />
            </div>

            <button
               type='submit'
               disabled={loading}
               style={{
                  width: "100%",
                  backgroundColor: loading ? "#ccc" : "#007bff",
                  color: "white",
                  border: "none",
                  padding: "12px",
                  borderRadius: "4px",
                  cursor: loading ? "not-allowed" : "pointer",
                  fontSize: "16px",
               }}
            >
               {loading ? "Logging in..." : "Login"}
            </button>
         </form>
      </div>
   );
}

// Dashboard Component
function Dashboard() {
   const { user, logout } = useAuth();

   return (
      <div style={{ padding: "20px" }}>
         <header
            style={{
               display: "flex",
               justifyContent: "space-between",
               alignItems: "center",
               marginBottom: "30px",
               padding: "20px",
               backgroundColor: "#f8f9fa",
               borderRadius: "8px",
            }}
         >
            <div>
               <h1>Welcome, {user.name}!</h1>
               <p>Email: {user.email}</p>
            </div>
            <button
               onClick={logout}
               style={{
                  backgroundColor: "#dc3545",
                  color: "white",
                  border: "none",
                  padding: "10px 20px",
                  borderRadius: "4px",
                  cursor: "pointer",
               }}
            >
               Logout
            </button>
         </header>

         <main>
            <h2>Your Dashboard</h2>
            <p>
               This is a protected area only accessible to authenticated users.
            </p>
         </main>
      </div>
   );
}
```

## Custom Hooks

Custom hooks allow you to extract component logic into reusable functions.

### Basic Custom Hooks

```jsx
// useCounter Hook
function useCounter(initialValue = 0) {
   const [count, setCount] = useState(initialValue);

   const increment = useCallback(() => {
      setCount((prev) => prev + 1);
   }, []);

   const decrement = useCallback(() => {
      setCount((prev) => prev - 1);
   }, []);

   const reset = useCallback(() => {
      setCount(initialValue);
   }, [initialValue]);

   return {
      count,
      increment,
      decrement,
      reset,
   };
}

// useLocalStorage Hook
function useLocalStorage(key, initialValue) {
   // Get value from localStorage or use initial value
   const [storedValue, setStoredValue] = useState(() => {
      try {
         const item = window.localStorage.getItem(key);
         return item ? JSON.parse(item) : initialValue;
      } catch (error) {
         console.error(`Error reading localStorage key "${key}":`, error);
         return initialValue;
      }
   });

   // Update localStorage when value changes
   const setValue = useCallback(
      (value) => {
         try {
            // Allow value to be a function so we have the same API as useState
            const valueToStore =
               value instanceof Function ? value(storedValue) : value;
            setStoredValue(valueToStore);
            window.localStorage.setItem(key, JSON.stringify(valueToStore));
         } catch (error) {
            console.error(`Error setting localStorage key "${key}":`, error);
         }
      },
      [key, storedValue]
   );

   return [storedValue, setValue];
}

// useFetch Hook
function useFetch(url, options = {}) {
   const [data, setData] = useState(null);
   const [loading, setLoading] = useState(true);
   const [error, setError] = useState(null);

   useEffect(() => {
      const fetchData = async () => {
         try {
            setLoading(true);
            setError(null);

            const response = await fetch(url, options);

            if (!response.ok) {
               throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            setData(result);
         } catch (err) {
            setError(err.message);
         } finally {
            setLoading(false);
         }
      };

      fetchData();
   }, [url, JSON.stringify(options)]);

   return { data, loading, error };
}

// useDebounce Hook
function useDebounce(value, delay) {
   const [debouncedValue, setDebouncedValue] = useState(value);

   useEffect(() => {
      const handler = setTimeout(() => {
         setDebouncedValue(value);
      }, delay);

      return () => {
         clearTimeout(handler);
      };
   }, [value, delay]);

   return debouncedValue;
}

// Using Custom Hooks
function CounterApp() {
   const { count, increment, decrement, reset } = useCounter(0);
   const [settings, setSettings] = useLocalStorage("counterSettings", {
      theme: "light",
      step: 1,
   });

   return (
      <div
         style={{
            textAlign: "center",
            padding: "20px",
            backgroundColor: settings.theme === "light" ? "#fff" : "#333",
            color: settings.theme === "light" ? "#333" : "#fff",
            minHeight: "200px",
         }}
      >
         <h2>Counter: {count}</h2>

         <div style={{ margin: "20px 0" }}>
            <button
               onClick={decrement}
               style={{ margin: "0 5px", padding: "10px 15px" }}
            >
               -
            </button>
            <button
               onClick={increment}
               style={{ margin: "0 5px", padding: "10px 15px" }}
            >
               +
            </button>
            <button
               onClick={reset}
               style={{ margin: "0 5px", padding: "10px 15px" }}
            >
               Reset
            </button>
         </div>

         <div>
            <label>
               Theme:
               <select
                  value={settings.theme}
                  onChange={(e) =>
                     setSettings((prev) => ({ ...prev, theme: e.target.value }))
                  }
                  style={{ marginLeft: "10px", padding: "5px" }}
               >
                  <option value='light'>Light</option>
                  <option value='dark'>Dark</option>
               </select>
            </label>
         </div>
      </div>
   );
}

// Search Component using useFetch and useDebounce
function SearchComponent() {
   const [query, setQuery] = useState("");
   const debouncedQuery = useDebounce(query, 500);

   const {
      data: users,
      loading,
      error,
   } = useFetch(
      debouncedQuery
         ? `https://jsonplaceholder.typicode.com/users?name_like=${debouncedQuery}`
         : null
   );

   return (
      <div style={{ maxWidth: "600px", margin: "0 auto", padding: "20px" }}>
         <h2>User Search</h2>

         <input
            type='text'
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            placeholder='Search users...'
            style={{
               width: "100%",
               padding: "12px",
               border: "2px solid #ddd",
               borderRadius: "8px",
               fontSize: "16px",
               marginBottom: "20px",
            }}
         />

         {loading && <div>Searching...</div>}
         {error && <div style={{ color: "red" }}>Error: {error}</div>}

         {users && (
            <div>
               <h3>Results ({users.length})</h3>
               {users.map((user) => (
                  <div
                     key={user.id}
                     style={{
                        border: "1px solid #ddd",
                        borderRadius: "8px",
                        padding: "15px",
                        marginBottom: "10px",
                     }}
                  >
                     <h4>{user.name}</h4>
                     <p>Email: {user.email}</p>
                     <p>Username: @{user.username}</p>
                  </div>
               ))}
            </div>
         )}
      </div>
   );
}
```

## Performance Optimization

### React.memo

```jsx
import React, { memo, useState, useCallback } from "react";

// Regular component - re-renders on every parent render
function ExpensiveComponent({ user, onUpdate }) {
   console.log("ExpensiveComponent rendered");

   return (
      <div>
         <h3>{user.name}</h3>
         <p>{user.email}</p>
         <button onClick={() => onUpdate(user.id)}>Update</button>
      </div>
   );
}

// Memoized component - only re-renders when props change
const MemoizedExpensiveComponent = memo(function ExpensiveComponent({
   user,
   onUpdate,
}) {
   console.log("MemoizedExpensiveComponent rendered");

   return (
      <div>
         <h3>{user.name}</h3>
         <p>{user.email}</p>
         <button onClick={() => onUpdate(user.id)}>Update</button>
      </div>
   );
});

// Custom comparison function
const SmartMemoizedComponent = memo(
   function ExpensiveComponent({ user, onUpdate }) {
      console.log("SmartMemoizedComponent rendered");

      return (
         <div>
            <h3>{user.name}</h3>
            <p>{user.email}</p>
            <button onClick={() => onUpdate(user.id)}>Update</button>
         </div>
      );
   },
   (prevProps, nextProps) => {
      // Only re-render if user data actually changed
      return (
         prevProps.user.id === nextProps.user.id &&
         prevProps.user.name === nextProps.user.name &&
         prevProps.user.email === nextProps.user.email
      );
   }
);
```

### useCallback and useMemo

```jsx
import React, { useState, useCallback, useMemo } from "react";

function OptimizedApp() {
   const [users, setUsers] = useState([
      { id: 1, name: "John", age: 25, active: true },
      { id: 2, name: "Jane", age: 30, active: false },
      { id: 3, name: "Bob", age: 35, active: true },
   ]);
   const [filter, setFilter] = useState("all");
   const [counter, setCounter] = useState(0);

   // useCallback - memoize function to prevent unnecessary re-renders
   const handleUserUpdate = useCallback((userId) => {
      setUsers((prevUsers) =>
         prevUsers.map((user) =>
            user.id === userId ? { ...user, active: !user.active } : user
         )
      );
   }, []); // No dependencies, function never changes

   // useMemo - memoize expensive calculations
   const filteredUsers = useMemo(() => {
      console.log("Filtering users...");

      return users.filter((user) => {
         if (filter === "active") return user.active;
         if (filter === "inactive") return !user.active;
         return true; // 'all'
      });
   }, [users, filter]); // Only recalculate when users or filter changes

   const userStats = useMemo(() => {
      console.log("Calculating stats...");

      return {
         total: users.length,
         active: users.filter((u) => u.active).length,
         inactive: users.filter((u) => !u.active).length,
         averageAge: users.reduce((sum, u) => sum + u.age, 0) / users.length,
      };
   }, [users]);

   return (
      <div style={{ padding: "20px" }}>
         <h1>User Management</h1>

         {/* This counter doesn't affect user list rendering thanks to optimization */}
         <div style={{ marginBottom: "20px" }}>
            <button onClick={() => setCounter((c) => c + 1)}>
               Counter: {counter}
            </button>
         </div>

         {/* Filter controls */}
         <div style={{ marginBottom: "20px" }}>
            <label>Filter: </label>
            <select
               value={filter}
               onChange={(e) => setFilter(e.target.value)}
               style={{ padding: "5px" }}
            >
               <option value='all'>All Users</option>
               <option value='active'>Active Users</option>
               <option value='inactive'>Inactive Users</option>
            </select>
         </div>

         {/* Stats */}
         <div
            style={{
               backgroundColor: "#f8f9fa",
               padding: "15px",
               borderRadius: "8px",
               marginBottom: "20px",
            }}
         >
            <h3>Statistics</h3>
            <p>Total: {userStats.total}</p>
            <p>Active: {userStats.active}</p>
            <p>Inactive: {userStats.inactive}</p>
            <p>Average Age: {userStats.averageAge.toFixed(1)}</p>
         </div>

         {/* User list */}
         <div>
            <h3>Users ({filteredUsers.length})</h3>
            {filteredUsers.map((user) => (
               <MemoizedExpensiveComponent
                  key={user.id}
                  user={user}
                  onUpdate={handleUserUpdate}
               />
            ))}
         </div>
      </div>
   );
}
```

### Lazy Loading with React.lazy

```jsx
import React, { lazy, Suspense, useState } from "react";

// Lazy load components
const Dashboard = lazy(() => import("./Dashboard"));
const Profile = lazy(() => import("./Profile"));
const Settings = lazy(() => import("./Settings"));

// Loading component
function LoadingSpinner() {
   return (
      <div
         style={{
            display: "flex",
            justifyContent: "center",
            alignItems: "center",
            height: "200px",
         }}
      >
         <div
            style={{
               border: "4px solid #f3f3f3",
               borderTop: "4px solid #3498db",
               borderRadius: "50%",
               width: "40px",
               height: "40px",
               animation: "spin 1s linear infinite",
            }}
         ></div>
         <style jsx>{`
            @keyframes spin {
               0% {
                  transform: rotate(0deg);
               }
               100% {
                  transform: rotate(360deg);
               }
            }
         `}</style>
      </div>
   );
}

function App() {
   const [currentView, setCurrentView] = useState("dashboard");

   const renderView = () => {
      switch (currentView) {
         case "dashboard":
            return <Dashboard />;
         case "profile":
            return <Profile />;
         case "settings":
            return <Settings />;
         default:
            return <Dashboard />;
      }
   };

   return (
      <div>
         <nav
            style={{
               backgroundColor: "#333",
               padding: "1rem",
               marginBottom: "20px",
            }}
         >
            <button
               onClick={() => setCurrentView("dashboard")}
               style={{
                  backgroundColor:
                     currentView === "dashboard" ? "#007bff" : "transparent",
                  color: "white",
                  border: "1px solid #007bff",
                  padding: "8px 16px",
                  marginRight: "10px",
                  cursor: "pointer",
               }}
            >
               Dashboard
            </button>
            <button
               onClick={() => setCurrentView("profile")}
               style={{
                  backgroundColor:
                     currentView === "profile" ? "#007bff" : "transparent",
                  color: "white",
                  border: "1px solid #007bff",
                  padding: "8px 16px",
                  marginRight: "10px",
                  cursor: "pointer",
               }}
            >
               Profile
            </button>
            <button
               onClick={() => setCurrentView("settings")}
               style={{
                  backgroundColor:
                     currentView === "settings" ? "#007bff" : "transparent",
                  color: "white",
                  border: "1px solid #007bff",
                  padding: "8px 16px",
                  cursor: "pointer",
               }}
            >
               Settings
            </button>
         </nav>

         <main style={{ padding: "20px" }}>
            <Suspense fallback={<LoadingSpinner />}>{renderView()}</Suspense>
         </main>
      </div>
   );
}
```

## Advanced Patterns

### Compound Component Pattern

```jsx
function Tabs({ children, defaultActiveTab = 0 }) {
   const [activeTab, setActiveTab] = useState(defaultActiveTab);

   const tabs = React.Children.toArray(children);

   return (
      <div style={{ border: "1px solid #ddd", borderRadius: "8px" }}>
         {/* Tab headers */}
         <div
            style={{
               display: "flex",
               borderBottom: "1px solid #ddd",
               backgroundColor: "#f8f9fa",
            }}
         >
            {tabs.map((tab, index) => (
               <button
                  key={index}
                  onClick={() => setActiveTab(index)}
                  style={{
                     padding: "12px 24px",
                     border: "none",
                     backgroundColor:
                        activeTab === index ? "#007bff" : "transparent",
                     color: activeTab === index ? "white" : "#333",
                     cursor: "pointer",
                     borderBottom:
                        activeTab === index ? "2px solid #007bff" : "none",
                  }}
               >
                  {tab.props.label}
               </button>
            ))}
         </div>

         {/* Tab content */}
         <div style={{ padding: "20px" }}>{tabs[activeTab]}</div>
      </div>
   );
}

function Tab({ children, label }) {
   return <div>{children}</div>;
}

// Usage
function TabsExample() {
   return (
      <div style={{ maxWidth: "600px", margin: "0 auto", padding: "20px" }}>
         <h2>Compound Component Example</h2>

         <Tabs defaultActiveTab={0}>
            <Tab label='Home'>
               <h3>Home Content</h3>
               <p>
                  Welcome to the home tab! This is where you'll find general
                  information.
               </p>
            </Tab>

            <Tab label='About'>
               <h3>About Us</h3>
               <p>Learn more about our company and mission.</p>
               <ul>
                  <li>Founded in 2020</li>
                  <li>Serving customers worldwide</li>
                  <li>Committed to excellence</li>
               </ul>
            </Tab>

            <Tab label='Contact'>
               <h3>Contact Information</h3>
               <p>Get in touch with us!</p>
               <p>Email: contact@example.com</p>
               <p>Phone: (555) 123-4567</p>
            </Tab>
         </Tabs>
      </div>
   );
}
```

### Render Props Pattern

```jsx
function DataFetcher({ url, render }) {
   const [data, setData] = useState(null);
   const [loading, setLoading] = useState(true);
   const [error, setError] = useState(null);

   useEffect(() => {
      const fetchData = async () => {
         try {
            setLoading(true);
            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to fetch");
            const result = await response.json();
            setData(result);
         } catch (err) {
            setError(err.message);
         } finally {
            setLoading(false);
         }
      };

      fetchData();
   }, [url]);

   return render({ data, loading, error });
}

// Usage
function RenderPropsExample() {
   return (
      <div style={{ maxWidth: "600px", margin: "0 auto", padding: "20px" }}>
         <h2>Render Props Pattern</h2>

         <DataFetcher
            url='https://jsonplaceholder.typicode.com/users'
            render={({ data, loading, error }) => {
               if (loading) return <div>Loading users...</div>;
               if (error) return <div>Error: {error}</div>;

               return (
                  <div>
                     <h3>Users</h3>
                     <ul>
                        {data?.map((user) => (
                           <li key={user.id}>
                              {user.name} - {user.email}
                           </li>
                        ))}
                     </ul>
                  </div>
               );
            }}
         />
      </div>
   );
}
```

## Complete Example: Shopping Cart Application

Let's build a complete shopping cart application using all the concepts we've
learned:

```jsx
import React, { createContext, useContext, useReducer, useEffect } from "react";

// Cart Context
const CartContext = createContext();

// Cart Reducer
function cartReducer(state, action) {
   switch (action.type) {
      case "ADD_ITEM":
         const existingItem = state.items.find(
            (item) => item.id === action.payload.id
         );

         if (existingItem) {
            return {
               ...state,
               items: state.items.map((item) =>
                  item.id === action.payload.id
                     ? { ...item, quantity: item.quantity + 1 }
                     : item
               ),
            };
         }

         return {
            ...state,
            items: [...state.items, { ...action.payload, quantity: 1 }],
         };

      case "REMOVE_ITEM":
         return {
            ...state,
            items: state.items.filter((item) => item.id !== action.payload),
         };

      case "UPDATE_QUANTITY":
         return {
            ...state,
            items: state.items
               .map((item) =>
                  item.id === action.payload.id
                     ? { ...item, quantity: action.payload.quantity }
                     : item
               )
               .filter((item) => item.quantity > 0),
         };

      case "CLEAR_CART":
         return {
            ...state,
            items: [],
         };

      case "LOAD_CART":
         return {
            ...state,
            items: action.payload,
         };

      default:
         return state;
   }
}

// Cart Provider
function CartProvider({ children }) {
   const [state, dispatch] = useReducer(cartReducer, { items: [] });

   // Load cart from localStorage on mount
   useEffect(() => {
      const savedCart = localStorage.getItem("cart");
      if (savedCart) {
         dispatch({ type: "LOAD_CART", payload: JSON.parse(savedCart) });
      }
   }, []);

   // Save cart to localStorage when it changes
   useEffect(() => {
      localStorage.setItem("cart", JSON.stringify(state.items));
   }, [state.items]);

   const addItem = (product) => {
      dispatch({ type: "ADD_ITEM", payload: product });
   };

   const removeItem = (productId) => {
      dispatch({ type: "REMOVE_ITEM", payload: productId });
   };

   const updateQuantity = (productId, quantity) => {
      dispatch({
         type: "UPDATE_QUANTITY",
         payload: { id: productId, quantity },
      });
   };

   const clearCart = () => {
      dispatch({ type: "CLEAR_CART" });
   };

   const getItemCount = () => {
      return state.items.reduce((total, item) => total + item.quantity, 0);
   };

   const getTotal = () => {
      return state.items.reduce(
         (total, item) => total + item.price * item.quantity,
         0
      );
   };

   const value = {
      items: state.items,
      addItem,
      removeItem,
      updateQuantity,
      clearCart,
      getItemCount,
      getTotal,
   };

   return <CartContext.Provider value={value}>{children}</CartContext.Provider>;
}

// Custom hook
function useCart() {
   const context = useContext(CartContext);
   if (!context) {
      throw new Error("useCart must be used within a CartProvider");
   }
   return context;
}

// Product List Component
const ProductList = React.memo(function ProductList({ products }) {
   const { addItem } = useCart();

   return (
      <div
         style={{
            display: "grid",
            gridTemplateColumns: "repeat(auto-fill, minmax(250px, 1fr))",
            gap: "20px",
            padding: "20px",
         }}
      >
         {products.map((product) => (
            <div
               key={product.id}
               style={{
                  border: "1px solid #ddd",
                  borderRadius: "8px",
                  padding: "15px",
                  textAlign: "center",
               }}
            >
               <img
                  src={product.image}
                  alt={product.name}
                  style={{
                     width: "100%",
                     height: "200px",
                     objectFit: "cover",
                     borderRadius: "4px",
                  }}
               />
               <h3 style={{ margin: "15px 0 10px 0" }}>{product.name}</h3>
               <p style={{ color: "#666", margin: "0 0 15px 0" }}>
                  {product.description}
               </p>
               <p
                  style={{
                     fontSize: "18px",
                     fontWeight: "bold",
                     color: "#007bff",
                     margin: "0 0 15px 0",
                  }}
               >
                  ${product.price.toFixed(2)}
               </p>
               <button
                  onClick={() => addItem(product)}
                  style={{
                     backgroundColor: "#28a745",
                     color: "white",
                     border: "none",
                     padding: "10px 20px",
                     borderRadius: "4px",
                     cursor: "pointer",
                     fontSize: "16px",
                  }}
               >
                  Add to Cart
               </button>
            </div>
         ))}
      </div>
   );
});

// Cart Component
function Cart() {
   const { items, removeItem, updateQuantity, clearCart, getTotal } = useCart();

   if (items.length === 0) {
      return (
         <div style={{ textAlign: "center", padding: "40px" }}>
            <h3>Your cart is empty</h3>
            <p>Add some products to get started!</p>
         </div>
      );
   }

   return (
      <div style={{ padding: "20px" }}>
         <div
            style={{
               display: "flex",
               justifyContent: "space-between",
               alignItems: "center",
               marginBottom: "20px",
            }}
         >
            <h2>Shopping Cart</h2>
            <button
               onClick={clearCart}
               style={{
                  backgroundColor: "#dc3545",
                  color: "white",
                  border: "none",
                  padding: "8px 16px",
                  borderRadius: "4px",
                  cursor: "pointer",
               }}
            >
               Clear Cart
            </button>
         </div>

         {items.map((item) => (
            <div
               key={item.id}
               style={{
                  display: "flex",
                  alignItems: "center",
                  padding: "15px",
                  border: "1px solid #ddd",
                  borderRadius: "8px",
                  marginBottom: "10px",
               }}
            >
               <img
                  src={item.image}
                  alt={item.name}
                  style={{
                     width: "60px",
                     height: "60px",
                     objectFit: "cover",
                     borderRadius: "4px",
                     marginRight: "15px",
                  }}
               />

               <div style={{ flex: 1 }}>
                  <h4 style={{ margin: "0 0 5px 0" }}>{item.name}</h4>
                  <p style={{ margin: 0, color: "#666" }}>
                     ${item.price.toFixed(2)} each
                  </p>
               </div>

               <div
                  style={{ display: "flex", alignItems: "center", gap: "10px" }}
               >
                  <button
                     onClick={() => updateQuantity(item.id, item.quantity - 1)}
                     style={{
                        backgroundColor: "#6c757d",
                        color: "white",
                        border: "none",
                        borderRadius: "50%",
                        width: "30px",
                        height: "30px",
                        cursor: "pointer",
                     }}
                  >
                     -
                  </button>

                  <span style={{ minWidth: "30px", textAlign: "center" }}>
                     {item.quantity}
                  </span>

                  <button
                     onClick={() => updateQuantity(item.id, item.quantity + 1)}
                     style={{
                        backgroundColor: "#28a745",
                        color: "white",
                        border: "none",
                        borderRadius: "50%",
                        width: "30px",
                        height: "30px",
                        cursor: "pointer",
                     }}
                  >
                     +
                  </button>

                  <button
                     onClick={() => removeItem(item.id)}
                     style={{
                        backgroundColor: "#dc3545",
                        color: "white",
                        border: "none",
                        padding: "5px 10px",
                        borderRadius: "4px",
                        cursor: "pointer",
                        marginLeft: "10px",
                     }}
                  >
                     Remove
                  </button>
               </div>
            </div>
         ))}

         <div
            style={{
               marginTop: "20px",
               padding: "20px",
               backgroundColor: "#f8f9fa",
               borderRadius: "8px",
               textAlign: "right",
            }}
         >
            <h3>Total: ${getTotal().toFixed(2)}</h3>
            <button
               style={{
                  backgroundColor: "#007bff",
                  color: "white",
                  border: "none",
                  padding: "12px 24px",
                  borderRadius: "4px",
                  cursor: "pointer",
                  fontSize: "16px",
                  marginTop: "10px",
               }}
            >
               Checkout
            </button>
         </div>
      </div>
   );
}

// Header Component
function Header() {
   const { getItemCount } = useCart();
   const [showCart, setShowCart] = useState(false);

   return (
      <>
         <header
            style={{
               backgroundColor: "#333",
               color: "white",
               padding: "1rem 2rem",
               display: "flex",
               justifyContent: "space-between",
               alignItems: "center",
            }}
         >
            <h1>React Shop</h1>
            <button
               onClick={() => setShowCart(!showCart)}
               style={{
                  backgroundColor: "#007bff",
                  color: "white",
                  border: "none",
                  padding: "10px 15px",
                  borderRadius: "4px",
                  cursor: "pointer",
                  position: "relative",
               }}
            >
               🛒 Cart
               {getItemCount() > 0 && (
                  <span
                     style={{
                        position: "absolute",
                        top: "-8px",
                        right: "-8px",
                        backgroundColor: "#dc3545",
                        color: "white",
                        borderRadius: "50%",
                        width: "20px",
                        height: "20px",
                        fontSize: "12px",
                        display: "flex",
                        alignItems: "center",
                        justifyContent: "center",
                     }}
                  >
                     {getItemCount()}
                  </span>
               )}
            </button>
         </header>

         {showCart && (
            <div
               style={{
                  position: "fixed",
                  top: 0,
                  right: 0,
                  width: "400px",
                  height: "100vh",
                  backgroundColor: "white",
                  boxShadow: "-2px 0 10px rgba(0,0,0,0.1)",
                  zIndex: 1000,
                  overflow: "auto",
               }}
            >
               <div
                  style={{
                     padding: "10px",
                     borderBottom: "1px solid #ddd",
                     display: "flex",
                     justifyContent: "space-between",
                     alignItems: "center",
                  }}
               >
                  <h3>Cart</h3>
                  <button
                     onClick={() => setShowCart(false)}
                     style={{
                        background: "none",
                        border: "none",
                        fontSize: "20px",
                        cursor: "pointer",
                     }}
                  >
                     ✕
                  </button>
               </div>
               <Cart />
            </div>
         )}

         {showCart && (
            <div
               style={{
                  position: "fixed",
                  top: 0,
                  left: 0,
                  width: "100%",
                  height: "100%",
                  backgroundColor: "rgba(0,0,0,0.5)",
                  zIndex: 999,
               }}
               onClick={() => setShowCart(false)}
            />
         )}
      </>
   );
}

// Main App
function ShoppingApp() {
   const products = [
      {
         id: 1,
         name: "Laptop",
         price: 999.99,
         description: "High-performance laptop for work and gaming",
         image: "https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=300&h=200&fit=crop",
      },
      {
         id: 2,
         name: "Smartphone",
         price: 699.99,
         description: "Latest smartphone with amazing camera",
         image: "https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=300&h=200&fit=crop",
      },
      {
         id: 3,
         name: "Headphones",
         price: 199.99,
         description: "Wireless noise-canceling headphones",
         image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=200&fit=crop",
      },
   ];

   return (
      <CartProvider>
         <div>
            <Header />
            <main>
               <h2 style={{ textAlign: "center", margin: "20px 0" }}>
                  Featured Products
               </h2>
               <ProductList products={products} />
            </main>
         </div>
      </CartProvider>
   );
}
```

## Key Concepts Mastered

1. **Context API**: Global state management without prop drilling
2. **Custom Hooks**: Reusable logic extraction
3. **Performance Optimization**: React.memo, useCallback, useMemo
4. **Lazy Loading**: Code splitting with React.lazy
5. **Advanced Patterns**: Compound components, render props
6. **Real-world Architecture**: Complete application structure

## Best Practices Summary

1. **Use Context sparingly** - Only for truly global state
2. **Extract custom hooks** for reusable logic
3. **Optimize performance** where it matters
4. **Split your code** with lazy loading
5. **Choose the right pattern** for each use case
6. **Keep components focused** and composable

## Summary

Congratulations! You've completed the React tutorial series. In this final
module, you've learned:

✅ React Context API for global state management  
✅ Custom hooks for reusable logic  
✅ Performance optimization techniques  
✅ Advanced component patterns  
✅ Real-world application architecture  
✅ Best practices for scalable React apps

You now have the knowledge to build complex, performant React applications. Keep
practicing and exploring the React ecosystem!

## Next Steps

-  Explore React Router for navigation
-  Learn state management libraries (Redux, Zustand)
-  Study testing with React Testing Library
-  Experiment with React frameworks (Next.js, Gatsby)
-  Build real projects to reinforce your learning

Happy coding! 🚀
