---
title: "Loading & Error States"
description:
   "Design skeleton loaders, communicate failures, and retry gracefully."
module: "M3"
lesson: "3"
difficulty: "intermediate"
duration: "35"
project_phase: "Data"
prerequisites: ["/docs/react-new/m3/2_mock-api-fetching"]
learning_objectives:
   - "Render skeletons while requests are in flight"
   - "Handle API errors with retry options"
   - "Coordinate loading state with existing filter UI"
tags: ["loading", "error-handling", "ux"]
---

import { Accordions, Accordion } from "@/components/accordion";

# Loading & Error States

Polished apps communicate progress. We'll enhance `ListingSection` to show
skeletons during fetches and friendly messaging when something breaks.

---

## 1. Create Skeleton Component

Add `src/components/ListingSkeleton.tsx`:

```tsx
export function ListingSkeleton() {
   return (
      <div className='animate-pulse overflow-hidden rounded-2xl border border-white/10 bg-white/5'>
         <div className='h-48 w-full bg-white/10' />
         <div className='space-y-3 p-6'>
            <div className='h-5 w-3/4 rounded bg-white/10' />
            <div className='h-4 w-1/2 rounded bg-white/10' />
            <div className='flex gap-2'>
               <div className='h-6 w-16 rounded-full bg-white/10' />
               <div className='h-6 w-20 rounded-full bg-white/10' />
            </div>
            <div className='h-10 w-full rounded bg-white/10' />
         </div>
      </div>
   );
}
```

---

## 2. Render Skeletons when Loading

Inside `ListingSection`:

```tsx
const skeletons = Array.from({ length: 6 }, (_, index) => (
   <ListingSkeleton key={`skeleton-${index}`} />
));

return (
   <section>
      {/* filters */}
      <div className='grid gap-6 md:grid-cols-2 lg:grid-cols-3'>
         {status === "loading"
            ? skeletons
            : listings.length
            ? listings.map(/* render ListingCard */)
            : /* empty state */}
      </div>
   </section>
);
```

---

## 3. Handle Errors with Retry

```tsx
if (status === "error") {
   return (
      <section className='bg-slate-900/60 py-16'>
         <div className='mx-auto flex w-full max-w-3xl flex-col items-center gap-4 px-6 text-center'>
            <h2 className='text-2xl font-semibold text-white'>
               Unable to load listings
            </h2>
            <p className='text-sm text-slate-400'>
               {error ?? "Something went wrong. Please try again."}
            </p>
            <button
               type='button'
               onClick={() => onRetry?.()}
               className='rounded-full bg-emerald-400 px-6 py-2 text-sm font-medium text-emerald-950 hover:bg-emerald-300'
            >
               Retry
            </button>
         </div>
      </section>
   );
}
```

Expose an optional `onRetry` prop to `ListingSection` that simply calls the
`useListings` refetch by toggling a `refreshToken` state or updating a
timestamp. The simplest approach: include `Date.now()` in params when pressing
retry.

---

## Task · Implement Retry Logic

1. In `useListings`, accept a `refreshToken` parameter and include it in the
   dependency array.
2. In `ListingSection`, manage `refreshToken` state and pass
   `setRefreshToken(Date.now())` to the retry button.
3. Display a toast or inline confirmation when the retry succeeds (optional
   stretch).
4. Commit with `git commit -am "feat: add loading skeletons and retry"`.

<Accordions type='single' className='mt-4'>
   <Accordion title='Solution Walkthrough'>
      ```tsx
      // src/hooks/useListings.ts
      export function useListings(params: Record<string, unknown>, refreshToken: number) {
         // existing state
         useEffect(() => {
            // existing fetch
         }, [params.search, params.maxPrice, params.guests, params.categories, refreshToken]);

         return { data, status, error };
      }
      ```

      ```tsx
      // src/components/ListingSection.tsx
      const [refreshToken, setRefreshToken] = useState(() => Date.now());
      const { data: listings, status, error } = useListings(
         {
            search,
            maxPrice,
            guests,
            categories: categoriesParam,
         },
         refreshToken
      );

      if (status === "error") {
         return (
            <section className='bg-slate-900/60 py-16'>
               <div className='mx-auto flex w-full max-w-3xl flex-col items-center gap-4 px-6 text-center'>
                  <h2 className='text-2xl font-semibold text-white'>Unable to load listings</h2>
                  <p className='text-sm text-slate-400'>{error}</p>
                  <button
                     type='button'
                     onClick={() => setRefreshToken(Date.now())}
                     className='rounded-full bg-emerald-400 px-6 py-2 text-sm font-medium text-emerald-950 hover:bg-emerald-300'
                  >
                     Retry
                  </button>
               </div>
            </section>
         );
      }
      ```

      ```bash
      git add src/components/ListingSkeleton.tsx src/components/ListingSection.tsx src/hooks/useListings.ts
      git commit -m "feat: add loading skeletons and retry"
      ```

   </Accordion>
</Accordions>

---

## ✅ Validation Checklist

-  [ ] Skeletons display during loading.
-  [ ] Errors show actionable messaging with retry.
-  [ ] Retry triggers a fresh request, clearing previous errors.
